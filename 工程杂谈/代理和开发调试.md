# 前端代理和开发调试方案

## 前言
> 本文是基于团队内一位小姐姐[ArwenChan](https://github.com/ArwenChan)的文章基础上完善而来

## 一、混合APP页面调试

### 1.1 真机连接本地开发环境（开发时调试）
1. devServer 不需要设置 host 等（在 whistle rules 里面设置即可），但是需要设置 `disableHostCheck`:

	```
	devServer: {
		disableHostCheck: true
	}
	```
2. 在 whistle 中设置 rules:

	```
	www.test.com/hello/basepage localhost:8080/basepage
	```
有时候 `localhost` 不生效的话，尝试用本机IP代替。
**注意**：上面的例子，`www.test.com/hello/basepage`被代理后，本地 vue router 解析到的 path 仍然是 `hello/basepage` 而不是 `basepage`。
3. 给移动端 wifi 设置代理，代理地址为 `{本机IP}:8899`
4. 如果移动端是请求https，参照[这里](http://wproxy.org/whistle/webui/https.html)进行设置。

### 1.2 真机连接本机（bug调试）
1. 设置production环境的publicPath，然后 build。
2. 在 whistle 中代理 html 和各类静态资源：
```
www.test.com/hello/basepage file://D:/projects/project-name/dist/index.html
www.test.com/your-public-path file://D:/projects/project-name/dist
```
3. 配置whistle rules
whistle自带的weinre和log
```
# 像浏览器的 devtools 那样查看和修改页面结构
www.test.com weinre://test
www.test.com log://test
# 可以在 network 的log栏查看页面的log，也可以利用操作值注入自定义 js： log://{test.js}。
# 如果你喜欢将调试信息直接输出在手机屏幕上，可以注入微信的vConsole.js，但不可以和weinre一起用
```

weinre:
![weinre.gif](https://i.loli.net/2019/03/05/5c7e17185389c.gif)

log: 
![FnjMsJAaJffOLKkY9mpNRHttQ9ck.gif](https://i.loli.net/2019/03/05/5c7e187bcb803.gif)

如果你嫌弃weinre用的不如devtools顺手，可以看看[m-console](https://github.com/fwon/m-console)。


### 1.3 模拟器调试
> 真机调试是首要bug调试方式，但有时遇到由手机系统版本引起的bug，而没有对应真机，可尝试使用模拟器调试

#### 1.3.1 Andorid
Android 模拟器有专门的Webview Tester可以方便测试webview问题
1. 下载Android Studio，创建 AVD。
2. 启动模拟器，浏览器打开`http://{your-ip}:8899/cgi-bin/rootca`下载 whistle 证书。这里最好给两个凭据用途都安装一次。
3. 设置代理：进入设置=>wifi=>**长按**连接的wifi，选择“修改网络”，proxy：{your-ip}，port：8899。
4. 打开浏览器请求即可看到```whistle```的抓包记录。

#### 1.3.2 IOS
IOS模拟器必须依赖MAC，PC用户最多可以远程连接MAC上的模拟器
- PC安装```Visual Studio```
- [连接MAC](https://docs.microsoft.com/zh-cn/xamarin/ios/get-started/installation/windows/connecting-to-mac/)
- 启动IOS模拟器即可调用远程的ios模拟器

## 二 PC、移动端开发调试

前后端分离项目，可以直接通过代理转发请求即可，若需cookie的在F12开发者工具配置即可
下面说下非前后端分离项目的调试

### 2.1 Docker

### 2.2 文件请求代理
将静态资源的请求如js、css代理到本地文件，修改本地文件就能看到效果
下面是示例 whistle rules：
```
www.ekwing.com/resource/exam file://D:/svn-projects/exam/resource
```

### 2.3 移动真机调试

#### Andorid
利用Chrome Inspect连接Android，可以直接使用[devTools](https://developers.google.com/web/tools/chrome-devtools/remote-debugging/)

#### IOS
Safari可直接连接Iphone进行调试